網站 攻擊偵測 系統與方法 
 一種 網站 攻擊偵測 系統與方法 ， 用以 偵測網 站 攻擊 ， 本 方法 對 網站 所 收到 的 HTTP 請求 進行分析 ， 將 每一 個 請求 參數 ( Request   Parameter ) 分別 以 標記序列 表示 ， 然後 利用統計 方法 或 機器學習方法 來 對 每一 個 標記序列 進行 評分 ， 當一個 HTTP 請求 中的 任一 標記序列 的 分數 高於 所 設定 的 門檻值 時 ， 即 判斷 該 HTTP 請求 為 一 攻擊行為 。 
 本 發明 係 關於 一種 網站 攻擊偵測 系統與方法 ， 尤指 在 電腦網路 上 利用 其 機制 達到 偵測攻擊 行為 的 系統與方法 。 
 一般而言 ， 在 網站 攻擊行為 的 偵測 上 ， 多 採用 特徵碼 ( Signature ) 比對 的方式 來 進行 偵測 ， 管理員 從 已知的 攻擊行為 中 擷取 出 足以 代表 該 攻擊行為 的 特徵碼 ， 然後 將該 特徵碼 以 規則 ( Rule ) 的 形式 加入 入侵偵測系統 ( Intrusion   Detection   System , ID S ) 或 網站應用程式 防火牆 中 ( Web   Application   Firewall , W AF ) 。 
 但是 上述 的 網站 攻擊偵測 架構 卻 存在 著一個 很大 缺點 - 無法 有效 地 偵測到 變形 攻擊 ， 特徵碼 比對 的 偵測 方式 乃 針對 現行 已知的 攻擊行為 進行分析 ， 找出 一段 可 代表 攻擊 的 特徵碼 ， 而 入侵偵測系統 / 網站應用程式 防火牆 便 藉由 比對 所 過濾 的 封包資料 中 是否 包含 那些 攻擊特徵 碼 ， 以此 來 判斷 是否 有 攻擊行為 產生 ， 然而 ， 當 攻擊者 發起 一些 與 現行 攻擊行為 相似 ， 但 攻擊 碼 不 完全相同 的 變形 攻擊 時 ， 這種 以 特徵碼 為 基礎的 偵測機制 就 可能 因為 在 變種 攻擊 的 封包 中 比對 不到 特徵碼 而 失效 ； 再 加上 一個 攻擊行為 的 變形 攻擊 可能 多達 數十 甚至 數百種 ， 因此 並無法將 所有的 變形 攻擊 都 轉換成 特徵碼 來 進行 偵測 ， 所以 對於 以 特徵碼 為 基礎的 攻擊偵測 機制 來 說 ， 其並 無法 完整 地 偵測到 變形 攻擊 。 
 由此 可見 ， 上述 習用 方式 仍有 諸多 缺失 ， 實非 一 良善 之 設計者 ， 而 亟待 加以 改良 。 本 案發明 人鑑 於 上述 習用 方式 所 衍生 的 各項 缺點 ， 乃 亟思 加以 改良創新 ， 並經 多年 苦心 孤詣 潛心 研究 後 ， 終於 成功 研發 完成本 件 網站 攻擊偵測 方法 。 
 本 發明 之 目的在於 提供 一種 網站 攻擊偵測 系統與方法 ， 透過 標記 與 評分 請求 參數 ( Request   Parameter ) 以 判斷 某個 HTTP   Request 是否 為 攻擊行為 ， 達到 有效 且 準確地 偵測網 站 攻擊 之 目的 。 
 達成 上述 發明 目的 之一種 網站 攻擊偵測系統 包括 ： 一 標記序列 產生 模組 ， 對於 一個 HTTP   Request ， 負責 將其 所屬的 請求 參數轉換 成 標記序列 ， 標記序列 由 複數個 標記 組成 之 ； 一 標記 關聯 模組 ， 負責 根據 各 標記 之間 的 關聯強度 來 產生 標記序列 的 分數 ； 以及 一 攻擊偵測 模組 ， 其 根據 各 標記序列 的 分數 以及 門檻值 來 判斷 該 HTTP   Request 是否 為 攻擊行為 。 
 本 網站 攻擊偵測 方法 的 運作 流程 為 ， 標記序列 產生 模組 接受 HTTP   Request 輸入 並 產生 標記序列 ； 標記 關聯 模組 接受 標記序列 產生 模組 輸出的 標記序列 ， 並 產生 每個 標記序列 的 分數 ； 攻擊偵測 模組 根據 標記 關聯 模組 所 產生 之 各 標記序列 的 分數 以及 門檻值 ， 加以 判斷 該 HTTP   Request 是否 為 攻擊 。 
 標記序列 產生 模組 定義 了 複數個 標記 以及 標記 與 請求 參數字 串 的 關係 ， 其 主要 目的在於 簡化 請求 參數 以 讓 標記 關聯 模組 可以 對 其 施以 關聯分析 ， 例如 ， 請求 參數 中的 『 eval 』 、 『 script 』 字串 會 被 以 『 SCR IP T _ W ORD 』 這個 標記 取代 之 。 標記序列 產生 模組 以 HTTP   Request 為 輸入資料 ， 其 分析 並 擷取 所有的 請求 參數 ， 將之 轉換成 複數個 標記序列 。 
 標記 關聯 模組 利用統計 或 機器學習 ( 包含 隱藏式馬可夫模型 、 馬可夫鏈 、 類神經網路 、 決策樹 、 支持向量機 、 貝氏網路 ) 等 方法 來 產生 每一 個 標記序列 的 分數 ， 為 了 讓 標記 關聯 模組 有 計算 標記序列 分數的 準則 ， 所以 必須 先對 其 進行 訓練 ， 訓練方式 為 ， 給予 標記 關聯 模組 一些 屬於 攻擊 的 標記序列 樣本 資料 ， 透過 樣本 資料 的 訓練 ， 標記 關聯 模組 便 可 對 之後 輸入的 標記序列 計算 其 分數 。 標記序列 樣本 資料產生 方式 為 ， 先 取得 一些 經由 專家 鑑為 攻擊 的 HTTP   Request ， 然後 利用 標記序列 產生 模組 將 那些 請求 參數轉換 為 標記序列 樣本 。 
 攻擊偵測 模組 根據 各 標記序列 的 分數 、 輸入的 門檻值 進行 綜合 判斷 ， 以 決定 某一 HTTP   Request 是否 為 攻擊 ， 主要 判斷 原則 為 ， 當一 HTTP   Request 所屬的 任一 個 請求 參數 ， 其 分數 高於 門檻值 時 ， 即 判定 該 HTTP   Request 屬於 攻擊行為 。 
 100 ． ． ． 標記序列 產生 模組 
 200 ． ． ． 標記 關聯 模組 
 20 1 ． ． ． 標記 關聯 訓練 模組 
 20 2 ． ． ． 標記 關聯 上線 模組 
 30 0 ． ． ． 攻擊偵測 模組 
 
 請 參閱 以下 有關 本 發明 之 詳細說明 及其 附圖 ， 將可進 一步 瞭解 本 發明 之 技術 內容 及其 目的 功效 ； 有關 附圖 為 ： 
 圖 1 為 網站 攻擊偵測 裝置的 流程 架構圖 ； 
 圖 2 為 標記 關聯 模組 在 訓練 階段 的 流程圖 ； 
 圖3 為 標記 關聯 模組 之 計分 流程圖 ； 
 圖 4 為 攻擊偵測 模組 的 判斷 流程圖 ； 
 圖 5 為 標記 列表 - 1 ； 
 圖6 為 標記 列表 - 2 。 
 如 圖一 所示 為 網站 攻擊偵測系統 的 架構圖 ， 表示 本 發明 各模 組間 的 關係 與 運作 流程 ； 網站 攻擊偵測系統 包含 標記序列 產生 模組 100 、 標記 關聯 模組 200 與 攻擊偵測 模組 30 0 。 
 標記序列 產生 模組 100 接收 一 HTTP   Request 並從 中 擷取 出 所有的 請求 參數 ， 根據 一 定義 好的 標記 列表 將 請求 參數轉換 成 標記序列 ， 標記 列表 如圖 五 與 圖 六 所示 ， 圖五 用於 界定 請求 參數 中 每個 標記的 界限 ， 圖 六中 的 『 KEY 』 標記 代表 出現頻率 較 高的 字串 ， 所有 不 屬於 其他 標記的 字串 則以 『 VAR 』 標記 轉換 之 。 標記序列 產生 模組 100 最 後產 出一個 或 多個 標記序列 ， 標記序列 的 個數 等同 於 該 HTTP   Request 所 擁有 的 請求 參數數量 。 例如 ， 一 HTTP   Request 包含 二組 請求 參數 為 『 id = jacky 』 與 『 value = < script > al ert ( document . co okie ) < / script > 』 ， 則 該二 組 請求 參數 將會 被 標記序列 產生 模組轉換 成 『 KEY = VAR 』 與 『 KEY = < SCR IP T _ W ORD > ALE RT   VAR < / SCR IP T _ W ORD > 』 二組 標記序列 。 
 標記 關聯 模組 200 接受 標記序列 產生 模組 100 所 輸出 之 標記序列 ， 分別 計算 每個 標記序列 的 分數 後 將其 輸出 ； 標記 關聯 模組 200 採用 的 計分 方式 可以 是 任一 統計 或 機器學習方法 ( 包含 隱藏式馬可夫模型 、 馬可夫鏈 、 類神經網路 、 決策樹 、 支持向量機 、 貝氏網路 ) ， 本 實施例 中則 採用 隱藏式馬可夫模型 ( Hidden   Markov   Model , HMM ) 來 執行 標記序列 的 計分 。 標記 關聯 模組 200 必須 先 透過 訓練 階段 來 取得 計算 分數的 準則 ， 然後 才能 正式 對 標記序列 進行 計分 ， 如圖 二 所示 示為 標記 關聯 模組 200 在 訓練 階段 的 流程 ， 當 已知 為 攻擊 的 HTTP   Request 透過 標記序列 產生 模組轉換 成 標記序列 後 ， 將該 標記序列 輸入 標記 關聯 訓練 模組 20 1 ， 以此 方式 來 取得 各 標記 之間 的 關聯 程度 。 圖三 表示 標記 關聯 模組 200 完成 訓練 後開 始對 標記序列 進行 計分 動作 的 流程 ， 標記 關聯 上線 模組 20 2 根據 標記 關聯 訓練 模組 20 1 在 訓練 階段 所 取得 的 標記 關聯強度 資訊 ， 計算出 每個 標記序列 的 分數 ， 分數 越高 代表 該 標記序列 越 可能 隱含 攻擊行為 。 
 攻擊偵測 模組 30 0 接受 標記 關聯 模組 200 所 輸出 之 每個 標記序列 的 分數 後 ， 根據 預先定義 的 門檻值 來 判斷 該 HTTP   Request 是否 為 攻擊行為 ， 圖四 表示 攻擊偵測 模組 30 0的 判斷 流程圖 ， 其 步驟 包括 ： 301 先 利用 標記 列表 將 HTTP   Request 中的 請求 參數轉換 成一個 或 多個 標記序列 ， 儲存 標記 關聯 模組 200 所 輸出 之 每個 標記序列 的 分數 ； 30 2 利用 機器學習 或 統計方法 對 每一 個 標記序列 分別 進行 評分 ， 在 評分 之前 必須 先 進行 訓練 ， 因此 需 提供 該 方法 多個 已知 為 攻擊 或 正常 行為 的 標記序列 資料 ， 作為 前述 方法 習得 評分規則 的 訓練集 ， 以此 進行 訓練 ， 然後 一一 比對 每一 個 標記序列 的 分數 與 門檻值 的 關係 ； 303 在 所 儲存 的 標記序列 中 ， 當 任一 個 標記序列 分數 大於 門檻值 時則 判定 該 HTTP   Request 為 攻擊行為 ； 304 反之 ， 若 沒有 任何 一個 標記序列 分數 大於 門檻值 ， 則 判定 該 HTTP   Request 為 不 含 攻擊 的 正常 行為 。 
 本 發明 所 提供 之 網站 攻擊偵測 方法 ， 與 其他 習用 技術 相互比較 時 ， 更具 備 下列 優點 ： 
 1 . 本 發明 相對於 目前 常見 的 攻擊偵測 方法 ， 較能 完整 且 有效 地 偵測 變形 攻擊 。 
 2 . 本 發明 針對 每個 請求 參數 分別 處理計 算 ， 當 任一 請求 參數 被 判定 為 攻擊 時 ， 該 HTTP   Request 即 被 判定 為 攻擊 ， 相對於 有些 方法 只 對 整著 HTTP   Request 內容 進行 判斷 時 ， 本 發明 可 避免 攻擊程式碼 佔 HTTP   Request 內容 比例 過低 時 ， 其 容易 被 忽略 的問題 。 
 上列 詳細說明 乃 針對 本 發明 之一 可行 實施例 進行 具體說明 ， 惟該 實施例 並非 用以 限制 本 發明 之 專利範圍 ， 凡未 脫離 本 發明 技藝 精神 所為 之 等效 實施 或 變更 ， 均 應 包含於 本案 之 專利範圍 中 。 
 綜上 所述 ， 本案 不僅 於 技術 思想 上 確屬 創新 ， 並 具備 習用 之 傳統方法 所 不及 之 上述 多項 功效 ， 已 充分 符合 新穎性 及 進步性 之 法定 發明專利 要件 ， 爰 依法 提出申請 ， 懇請 貴局 核准 本 件 發明專利 申請案 ， 以勵 發明 ， 至 感德 便 。 
 一種 網站 攻擊偵測系統 ， 其中 包括 ： a . 標記序列 產生 模組 ， 其 根據 標記 列表 將 HTTP   Request 中的 請求 參數轉換 成 單數 或 複數個 標記序列 ， 其中 標記 列表 之 內容 並非 固定 ， 可 因 系統環境 而 有所不同 ； b . 標記 關聯 模組 ， 其 負責 對 標記序列 進行 評分 ； 及 c . 攻擊偵測 模組 ， 負責 根據 各 標記序列 的 分數 與 門檻值 等 外部資訊 ， 進行 綜合 判斷 該 HTTP   Request 是否 為 攻擊 。 
 
 如 申請專利範圍 第1 項 所述 之 網站 攻擊偵測系統 ， 其中 該 標記序列 產生 模組 乃 透過 一可 自行 定義 之 標籤列表 將 請求 參數轉換 成 標籤 序列 。 
 
 如 申請專利範圍 第1 項 所述 之 網站 攻擊偵測系統 ， 其中 該 標記 關聯 模組 需 經歷 訓練 階段 ， 訓練方式 為 ， 提供 複數個 屬於 攻擊 的 標記序列 輸入 至 標記 關聯 模組 ， 使 其 學習 攻擊 資料 的 架構 ； 攻擊 的 標記序列 則 藉由 將 屬於 攻擊 的 HTTP   Request 輸入 至 標記序列 產生 模組 ， 由 標記序列 產生 模組 產生 之 。 
 
 如 申請專利範圍 第1 項 所述 之 網站 攻擊偵測系統 ， 其中 該 標記 關聯 模組 可使用 統計方法 為 之 。 
 
 如 申請專利範圍 第1 項 所述 之 網站 攻擊偵測系統 ， 其中 該 標記 關聯 模組 可使用 隱藏式馬可夫模型 ( Hidden   Markov   Model ) 為 之 。 
 
 如 申請專利範圍 第1 項 所述 之 網站 攻擊偵測系統 ， 其中 該 標記 關聯 模組 可使用 馬可夫鏈 ( Markov   Chain ) 為 之 。 
 
 如 申請專利範圍 第1 項 所述 之 網站 攻擊偵測系統 ， 其中 該 標記 關聯 模組 可使用 類神經網路 ( Neural   Network ) 為 之 。 
 
 如 申請專利範圍 第1 項 所述 之 網站 攻擊偵測系統 ， 其中 該 標記 關聯 模組 可使用 決策樹 ( Decision   Tree ) 為 之 。 
 
 如 申請專利範圍 第1 項 所述 之 網站 攻擊偵測系統 ， 其中 該 標記 關聯 模組 可使用 支持向量機 ( Support   Vector   Machine ) 為 之 。 
 
 如 申請專利範圍 第1 項 所述 之 網站 攻擊偵測系統 ， 其中 該 標記 關聯 模組 可使用 貝氏網路 ( Bayesian   network ) 為 之 。 
 
 如 申請專利範圍 第1 項 所述 之 網站 攻擊偵測系統 ， 其中 該 攻擊偵測 模組 會將 各 標記序列 的 分數 與 門檻值 等 外部資訊 進行比對 ， 只要 任一 個 標記序列 被 認定為 攻擊 ( HOW ) ， 則該 HTTP   Request 即 被 認定為 攻擊 。 
 
 一種 網站 攻擊偵測 方法 ， 該 方法 包括 下列 步驟 ： a . 利用 標記 列表 將 HTTP   Request 中的 請求 參數轉換 成一個 或 多個 標記序列 ； b . 利用 機器學習 或 統計方法 對 每一 個 標記序列 分別 進行 評分 ； c . 在 評分 之前 必須 先 進行 訓練 ， 因此 需 提供 該 方法 多個 已知 為 攻擊 或 正常 行為 的 標記序列 資料 ， 作為 前述 方法 習得 評分規則 的 訓練集 ， 以此 進行 訓練 ； d . 比較 每一 個 標記序列 之 分數 與 門檻值 之 差異 ， 當 任一 個 標記序列 之 分數 高於 門檻值 時 ， 即 判定 該 HTTP   Request 含有 攻擊行為 ； 反之 ， 當 所有的 標記序列 之 分數 均 低於 門檻值 時 ， 即 判定 該 HTTP   Request 不 含 攻擊行為 。 
 